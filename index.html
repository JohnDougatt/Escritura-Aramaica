<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escritura Aramaica</title>
    <style>
        :root { 
            --primary: #1a1a1a; --accent: #c5a059; --bg: #f4f1ea; --text: #2c2c2c; --card: #ffffff; --border: #ddd;
        }

        body.dark-mode { 
            --primary: #000000; --accent: #e0b361; --bg: #121212; --text: #e0e0e0; --card: #1e1e1e; --border: #333;
        }
        
        body { font-family: 'Georgia', serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; transition: background 0.3s; }
        
        header { background: var(--primary); color: var(--accent); padding: 15px; text-align: center; border-bottom: 3px solid var(--accent); }
        
        .controls { background: var(--card); padding: 10px; display: flex; gap: 8px; justify-content: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; flex-wrap: wrap; }
        
        .search-box { display: flex; gap: 5px; width: 100%; max-width: 700px; justify-content: center; margin-top: 5px; }
        .search-box input { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid var(--accent); background: var(--card); color: var(--text); }

        select { padding: 10px; border-radius: 5px; border: 1px solid var(--accent); background: var(--card); color: var(--text); cursor: pointer; }

        .btn-ui { background: var(--primary); color: var(--accent); border: 1px solid var(--accent); padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        #leitura-container { flex: 1; overflow-y: auto; padding: 20px; }
        
        .content-card { max-width: 700px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); position: relative; }
        
        .versiculo { margin-bottom: 15px; font-size: 1.2rem; line-height: 1.6; border-bottom: 1px dotted var(--border); padding-bottom: 8px; display: flex; align-items: flex-start; cursor: pointer; transition: 0.2s; }
        .versiculo:hover { background: rgba(197, 160, 89, 0.1); }
        .versiculo.selected { background: rgba(197, 160, 89, 0.2); border-left: 4px solid var(--accent); padding-left: 10px; }
        
        .num { font-size: 0.8rem; color: var(--accent); font-weight: bold; margin-right: 10px; min-width: 20px; pointer-events: none; }
        
        .texto-v { flex: 1; pointer-events: none; }

        .aramaico { color: #d64545; font-weight: bold; }
        body.dark-mode .aramaico { color: #ff6b6b; }

        .btn-save-batch { 
            position: fixed; bottom: 20px; right: 20px; background: var(--accent); color: white; 
            border: none; padding: 15px 25px; border-radius: 50px; font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; display: none; z-index: 100;
        }

        #favoritos-container {
            position: fixed; right: -350px; top: 0; width: 300px; height: 100%;
            background: var(--card); box-shadow: -5px 0 15px rgba(0,0,0,0.5);
            z-index: 1000; padding: 20px; transition: 0.3s; overflow-y: auto; color: var(--text);
        }
        #favoritos-container.open { right: 0; }
        .close-fav { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text); float: right; }
        .fav-item { font-size: 0.95rem; border-bottom: 1px solid var(--border); padding: 15px 0; }
        .fav-ref { font-weight: bold; color: var(--accent); display: block; margin-bottom: 5px; }
        .btn-remover { color: #d64545; cursor: pointer; font-size: 0.8rem; margin-top: 5px; display: block; text-decoration: underline; }
    </style>
</head>
<body>

<header><h1 style="margin:0;">ESCRITURA ARAMAICA</h1></header>

<div class="controls">
    <select id="select-livro" onchange="atualizarCapitulos()"><option value="">Livro</option></select>
    <select id="select-capitulo" onchange="exibirTexto()"><option value="">Cap.</option></select>
    <button class="btn-ui" onclick="toggleDarkMode()" id="btn-dark">üåô</button>
    <button class="btn-ui" onclick="toggleFavoritos()">‚≠ê SALVOS</button>
    
    <div class="search-box">
        <input type="text" id="input-busca" placeholder="Buscar palavra...">
        <button class="btn-ui" onclick="buscarPalavra()">üîç</button>
    </div>
</div>

<button id="btn-salvar-lote" class="btn-save-batch" onclick="salvarSelecionados()">Salvar Selecionados (0)</button>

<div id="favoritos-container">
    <button class="close-fav" onclick="toggleFavoritos()">√ó</button>
    <h3 style="border-bottom: 2px solid var(--accent); padding-bottom: 10px;">Vers√≠culos Salvos</h3>
    <div id="lista-favoritos"></div>
</div>

<div id="leitura-container">
    <div class="content-card">
        <h2 id="titulo-capitulo" style="text-align:center;">Selecione a Escritura</h2>
        <div id="texto-biblico"></div>
    </div>
</div>

<script>
    let biblia = [];
    let selecionados = []; // Armazena os √≠ndices dos vers√≠culos selecionados

    const nomesLivros = {
        "gn": "Bereshit (G√™nesis)", "ex": "Shemot (√äxodo)", "lv": "Vayikra (Lev√≠tico)", 
        "nm": "Bamidbar (N√∫meros)", "dt": "Devarim (Deuteron√¥mio)", "js": "Yahushua (Josu√©)", 
        "jz": "Shoftim (Ju√≠zes)", "rt": "Rut (Rute)", "1sm": "Shmuel √Ålef (1 Samuel)", 
        "2sm": "Shmuel B√©t (2 Samuel)", "1rs": "Melakhim √Ålef (1 Reis)", "2rs": "Melakhim B√©t (2 Reis)",
        "1cr": "Divrei Hayamim √Ålef (1 Cr√¥nicas)", "2cr": "Divrei Hayamim B√©t (2 Cr√¥nicas)",
        "ed": "Ezra (Esdras)", "ne": "Nechemyah (Neemias)", "et": "Hadassah (Ester)", 
        "j√≥": "Iyov (J√≥)", "sl": "Tehilim (Salmos)", "pv": "Mishl√™ (Prov√©rbios)",
        "ec": "Qoh√™let (Eclesiastes)", "ct": "Shir Hashirim (Cantares)", 
        "is": "Yeshayahu (Isa√≠as)", "jr": "Yirmyahu (Jeremias)", "lm": "Eikh√°h (Lamenta√ß√µes)",
        "ez": "Yechezoel (Ezequiel)", "dn": "Dani√™l (Daniel)", "os": "Hosh√©a (Os√©ias)", 
        "jl": "Yoel (Joel)", "am": "Am√≥s (Am√≥s)", "ob": "Ovadyah (Obadias)",
        "jn": "Yon√°h (Jonas)", "mq": "Mikh√°h (Miqu√©ias)", "na": "Nachum (Naum)", 
        "hc": "Chavaquq (Habacuque)", "sf": "Tsefanyah (Sofonias)", "ag": "Khagay (Ageu)",
        "zc": "Zekharyah (Zacarias)", "ml": "Malakhi (Malaquias)", 
        "mt": "Mattityahu (Mateus)", "mc": "Yochanan Moshe (Marcos)", "lc": "Luka (Lucas)",
        "jo": "Yochanan (Jo√£o)", "at": "Maasei HaShlichim (Atos)", "rm": "El-haRomim (Romanos)", 
        "1co": "Qorintim √Ålef (1 Cor√≠ntios)", "2co": "Qorintim B√©t (2 Cor√≠ntios)", 
        "gl": "Galatim (G√°latas)", "ef": "Efesim (Ef√©sios)", "fp": "Filipim (Filipenses)", 
        "cl": "Qolossim (Colossenses)", "1ts": "Tesloniqyah √Ålef (1 Tessalonicenses)", 
        "2ts": "Tesloniqyah B√©t (2 Tessalonicenses)", "1tm": "Timoteos √Ålef (1 Tim√≥teo)", 
        "2tm": "Timoteos B√©t (2 Tim√≥teo)", "tt": "Titos (Tito)", "fm": "Filemon (Filemom)", 
        "hb": "Ivrim (Hebreus)", "tg": "Yaakov (Tiago)", "1pe": "Kefa √Ålef (1 Pedro)", 
        "2pe": "Kefa B√©t (2 Pedro)", "1jo": "Yochanan √Ålef (1 Jo√£o)", 
        "2jo": "Yochanan B√©t (2 Jo√£o)", "3jo": "Yochanan Guimel (3 Jo√£o)", 
        "jd": "Yehudah (Judas)", "ap": "Hitgalut (Apocalipse)"
    };

    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('btn-dark').textContent = '‚òÄÔ∏è';
    }

    function toggleDarkMode() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        document.getElementById('btn-dark').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    }

    async function carregarBiblia() {
        try {
            const response = await fetch('./nvi_aramaica.json');
            biblia = await response.json();
            popularLivros();
        } catch (e) {
            document.getElementById('texto-biblico').innerHTML = "Erro ao carregar arquivo. Use o Live Server.";
        }
    }

    function popularLivros() {
        const sel = document.getElementById('select-livro');
        sel.innerHTML = '<option value="">Livro</option>';
        biblia.forEach((l, i) => {
            let opt = document.createElement('option');
            opt.value = i;
            opt.textContent = nomesLivros[l.abbrev.toLowerCase()] || l.abbrev;
            sel.appendChild(opt);
        });
    }

    function atualizarCapitulos() {
        const i = document.getElementById('select-livro').value;
        const selCap = document.getElementById('select-capitulo');
        selCap.innerHTML = '<option value="">Cap.</option>';
        if(i==="") return;
        biblia[i].chapters.forEach((_, idx) => {
            let opt = document.createElement('option');
            opt.value = idx;
            opt.textContent = idx + 1;
            selCap.appendChild(opt);
        });
    }

    function formatarTexto(texto) {
        return texto.replace(/(Yahushua|Yahu|M√°rYa|Elohim|Meshikha)/g, '<span class="aramaico">$1</span>');
    }

    function exibirTexto(lIdx = null, cIdx = null) {
        const li = lIdx !== null ? lIdx : document.getElementById('select-livro').value;
        const ci = cIdx !== null ? cIdx : document.getElementById('select-capitulo').value;
        if(li==="" || ci==="") return;
        
        document.getElementById('select-livro').value = li;
        atualizarCapitulos();
        document.getElementById('select-capitulo').value = ci;

        const caps = biblia[li].chapters[ci];
        const nomeLivro = nomesLivros[biblia[li].abbrev.toLowerCase()] || biblia[li].abbrev;
        document.getElementById('titulo-capitulo').textContent = `${nomeLivro} ${parseInt(ci)+1}`;
        
        selecionados = []; 
        atualizarBotaoLote();

        let html = "";
        caps.forEach((v, idx) => {
            html += `
                <div class="versiculo" id="v-${idx}" onclick="toggleSelecao(${idx})">
                    <span class="num">${idx+1}</span>
                    <span class="texto-v">${formatarTexto(v)}</span>
                </div>`;
        });
        document.getElementById('texto-biblico').innerHTML = html;
        document.getElementById('leitura-container').scrollTop = 0;
    }

    function toggleSelecao(idx) {
        const el = document.getElementById(`v-${idx}`);
        const pos = selecionados.indexOf(idx);

        if (pos > -1) {
            selecionados.splice(pos, 1);
            el.classList.remove('selected');
        } else {
            selecionados.push(idx);
            el.classList.add('selected');
        }
        
        selecionados.sort((a, b) => a - b);
        atualizarBotaoLote();
    }

    function atualizarBotaoLote() {
        const btn = document.getElementById('btn-salvar-lote');
        if (selecionados.length > 0) {
            btn.style.display = 'block';
            btn.textContent = `Salvar Selecionados (${selecionados.length})`;
        } else {
            btn.style.display = 'none';
        }
    }

    function salvarSelecionados() {
        const li = document.getElementById('select-livro').value;
        const ci = document.getElementById('select-capitulo').value;
        const nomeLivro = nomesLivros[biblia[li].abbrev.toLowerCase()] || biblia[li].abbrev;
        
        let textoAgrupado = "";
        let refFinal = "";

        if (selecionados.length === 1) {
            textoAgrupado = biblia[li].chapters[ci][selecionados[0]];
            refFinal = `${nomeLivro} ${parseInt(ci)+1}:${selecionados[0]+1}`;
        } else {
            // Verificar se √© uma sequ√™ncia (ex: 1-3)
            const min = selecionados[0] + 1;
            const max = selecionados[selecionados.length - 1] + 1;
            refFinal = `${nomeLivro} ${parseInt(ci)+1}:${min}-${max}`;
            
            selecionados.forEach(idx => {
                textoAgrupado += `(${idx+1}) ${biblia[li].chapters[ci][idx]} `;
            });
        }

        salvarNoStorage(refFinal, textoAgrupado.trim());
        
        // Limpar sele√ß√£o
        selecionados.forEach(idx => {
            document.getElementById(`v-${idx}`).classList.remove('selected');
        });
        selecionados = [];
        atualizarBotaoLote();
    }

    function salvarNoStorage(ref, texto) {
        let salvos = JSON.parse(localStorage.getItem('favBiblia')) || [];
        if (salvos.some(s => s.ref === ref)) return alert("Este grupo j√° est√° salvo.");
        salvos.push({ ref, texto });
        localStorage.setItem('favBiblia', JSON.stringify(salvos));
        alert("Vers√≠culos salvos com sucesso!");
    }

    function toggleFavoritos() {
        const container = document.getElementById('favoritos-container');
        container.classList.toggle('open');
        if(container.classList.contains('open')) listarFavoritos();
    }

    function listarFavoritos() {
        const lista = document.getElementById('lista-favoritos');
        const salvos = JSON.parse(localStorage.getItem('favBiblia')) || [];
        if (salvos.length === 0) {
            lista.innerHTML = "<p>Nenhum salvo.</p>";
            return;
        }
        lista.innerHTML = salvos.map((s, i) => `
            <div class="fav-item">
                <span class="fav-ref">${s.ref}</span>
                <span>${s.texto}</span>
                <span class="btn-remover" onclick="removerFavorito(${i})">Remover</span>
            </div>
        `).join('');
    }

    function removerFavorito(i) {
        let salvos = JSON.parse(localStorage.getItem('favBiblia')) || [];
        salvos.splice(i, 1);
        localStorage.setItem('favBiblia', JSON.stringify(salvos));
        listarFavoritos();
    }

    carregarBiblia();
</script>
</body>
</html>